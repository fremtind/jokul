---
title: Utvikle for J칮kul
path: /endre/utvikling
order: 2
---

# Slik skriver du kode til J칮kul

S친 bra du vil skrive J칮kul-kode! 游봅

J칮kul er et fellesprosjekt for alle i Fremtind. Det vil si at det ogs친 er _ditt_.

칀 programmere i J칮kul er ganske likt annen frontendprogrammering. Forskjellen fra n친r du lager en _app_ er at vi lager _bibliotek_ som brukes i apper. I praksis vil du sjeldent merke noen stor forskjell, med mindre du skal lage helt nye pakker eller jobbe med infrastrukturen i J칮kul.

F칮r du setter i gang er det lurt 친 ha sett p친 [Bidra til designsystemet](/komigang/prosessen).

Om du er usikker p친 noe eller st친r fast er det kort vei til 친 f친 hjelp p친 [Discussions](https://github.com/fremtind/jokul/discussions/categories/sp칮rsm친l-og-svar), Support Designsystem p친 Teams, eller ved 친 sp칮rre noen p친 designsystemforum.

## Utviklingsmilj칮

Dette m친 v칝re installert p친 maskinen for 친 jobbe i J칮kul:

-   [Node](https://nodejs.org/en/download/) Long Term Support release (LTS)
-   [Yarn Classic](https://classic.yarnpkg.com/lang/en/)
-   [Git](https://git-scm.com) 2.0.0 eller nyere

N친r maskinen er klar er det tre steg for 친 komme i gang:

1. Klon [J칮kul-biblioteket](https://github.com/fremtind/jokul) fra GitHub (du kan lage deg en fork om du ikke har tilgang, eller h칮re med n칝rmeste leder om 친 bli lagt til i GitHub-organisasjonen)
2. Lag en ny branch basert p친 `main`-branchen
3. Bygg prosjektet med kommandoen `yarn boot`

## Her finner du pakkene

Alle komponentene er organisert under mappen _[packages](https://github.com/fremtind/jokul/tree/main/packages)_. De som slutter p친 `-react` er React-pakker. De som ikke har en endelse, er stilpakker.

Grunnen til at vi deler opp i React- og stilpakker er for 친 kunne la for eksempel et CMS som ikke bruker React fremdeles bruke J칮kul-stiler.

## Eksempel p친 en endring

La oss si at vi savner en _prop_ fra en av typedefinisjonene i J칮kul. `LoaderProps` mangler muligheten for 친 gi den en `id`. Hvordan legger vi den til?

```ts
export interface LoaderProps {
    // TODO: legg til ID-prop
    className?: string;
}
```

F칮r vi gj칮r en endring er det greit 친 sjekke at vi har en oppdatert `main`-branch. Om det er f칮rste gang vi gj칮r en endring i J칮kul m친 vi ha kj칮rt `yarn boot`.

### Gj칮r endringen p친 en ny branch

Med oppdatert `main` er det klart for 친 lage en branch:

```sh
$ git checkout -b feat/loader-id
```

Her har vi valgt 친 se p친 dette som en ny _feature_. Om dette hadde v칝rt en bugfix ville det v칝rt naturlig 친 starte branchnavnet med `fix/`.

<aside className="jkl-portal-paragraph">
    <InfoMessageBox role="none presentation" forceCompact fullWidth>
        <p className="jkl-small">
            Ikke bruk mye tid p친 branchnavnet! Det viktiste er at du finner igjen branchen din senere om du skulle
            trenge det.
        </p>
    </InfoMessageBox>
</aside>

Med branchen v친r klar er det p친 tide 친 gj칮re endringen:

```ts
export interface LoaderProps {
    id?: string;
    className?: string;
}
```

F칮r vi lager en commit er det lurt 친 sjekke at endringen v친r ikke har 칮delagt noe. For 친 v칝re _helt_ sikker kan du kj칮re kommandoene `yarn build` og `yarn ci:test` p친 toppniv친 i J칮kul (alts친 `./`, ikke i mappen `./packages/loader-react`). Det kan ta litt tid.

I akkurat dette tilfellet har vi bare endret en typedefinisjon, s친 det holder 친 kj칮re `yarn typecheck`. Hvis det ikke kommer noen feilmeldinger er alt klart for 친 lage en commit.

### Visuelle regresjonstester

De aller fleste komponentene i J칮kul har visuelle regresjonstester, for 친 ha en m친te 친 fange opp uventede visuelle endringer. Disse testene baserer seg p친 _snapshots_. Snapshots er skjermbilder av komponentens eksempler, tatt av [Cypress](https://www.cypress.io). Cypress sammenligner utseendet p친 branchen din med disse skjermbildene.

Hvis du gj칮r en villet endring i utseendet til en komponent m친 mappen `<pakkenavn>-react/integration/__image_snapshots__` slettes. GitHub Actions vil generere nye snapshots for deg.

I v친rt tilfelle er det ingen visuell endring, s친 vi hopper over dette steget.

<aside className="jkl-portal-paragraph">
    <InfoMessageBox role="none presentation" forceCompact fullWidth>
        <p className="jkl-small">
            Siden skjermbilder tas av eksemplene m친 du ogs친 slette snapshots om du for eksempel endrer navn eller
            rekkef칮lge p친 spakene som styrer eksempelet.
        </p>
    </InfoMessageBox>
</aside>

#### Kort om enhetstester

I dette eksempelet hopper vi over enhetstester, men for en endring som fikser en bug eller legger til funksjonalitet ville vi ha skrevet noen. Enhetstester skal ligge sammen med komponenten, med filnavn p친 formen `<MinKomponent>.test.tsx` eller `<minFunksjon>.test.ts`.

Enhetstestene skal sikre at n칮kkelfunksjonaliteten til komponenten virker. For eksempel kan testene for en knapp sjekke at den blir rendret til DOM, og at den kaller riktig funksjon n친r man klikker p친 den.

Vi bruker [Jest](https://jestjs.io/) som test runner og [React testing library](https://testing-library.com/docs/react-testing-library/intro) for 친 h친ndtere React-komponenter.

### Lag en commit

Til 친 lage commits bruker vi kommandoen `yarn commit`. Grunnen til det er at commitmeldingene brukes for 친 generere changelogs og versjonsnummer basert p친 [Semantic Versioning](https://semver.org). Det kan vi gj칮re fordi `yarn commit` formaterer commitmeldinger p친 en spesiell m친te kalt [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/). Hvis en commitmelding starter med `feat:` vil det automatisk lages en _minor_-release av pakken som ble endret.

<aside className="jkl-portal-paragraph">
    <WarningMessageBox role="none presentation" forceCompact fullWidth>
        <p className="jkl-small">
            Bruk <code>yarn commit</code> for 친 lage commits!
        </p>
    </WarningMessageBox>
</aside>

N친r vi kj칮rer `yarn commit` startes det en veiviser. Her blir du bedt om 친 velge hvilken type endring vi har gjort. I v친rt tilfelle velger vi `feat:`. Du kan skrive typen, eller velge med piltastene. Trykk Enter.

Neste trinn i veiviseren er _commit-tittelen_. Her skriver du kort hva som er gjort, for eksempel `la til id i LoaderProps`. Trykk Enter.

Neste trinn er en valgfri _commit body_. Her vil mange kanskje foretrekke 친 bare trykke Enter og heller gj칮re en `git commit --amend` senere for 친 bruke en annen editor for 친 skrive. Vi trykker bare Enter og g친r videre.

Vi blir spurt om vi har noen **BREAKING CHANGES**. Vi har ikke det denne gangen. Hvis du _har_ det, beskriv dem her. Hvis en commitmelding har `BREAKING CHANGE:` i _footeren_ vil det automatisk lages en _major_-release av pakken som ble endret.

Til slutt blir vi spurt om 친 liste _ISSUES CLOSED_. Her kan du skrive issue-nummeret fra GitHub (inkludert `#`, f. eks. `#1234`) dersom endringen din vil gj칮re at et issue kan lukkes.

### Del branchen din

Puh! Det var en del steg. Alt dette er for at automatikken ved publisering skal fungere riktig.

N친 kan du pushe endringen din og 친pne en pull request.

## Pull requests

Pull requests (PR) lager du [p친 GitHub](https://github.com/fremtind/jokul/compare). Vanligvis er det `main`-branchen du setter som _base_, og branchen med endringene dine du setter som _compare_.

N친r du lager en PR blir du vist et skjema med en mal som kan fylles ut. Det er supert om du gir en kort beskrivelse av innholdet i pull requesten, og lenker til relevante issues og discussions. Sjekk gjerne ogs친 av punktene i sjekklisten ved 친 endre `[ ]` til `[x]`.

<aside className="jkl-portal-paragraph">
    <InfoMessageBox role="none presentation" fullWidth forceCompact title="Sender du en pull request fra en fork?">
        <p className="jkl-small">
            Sett <code>external-contributions</code> som <i>base</i> for pull requesten, s친 loser en maintainer koden
            videre til <code>main</code>.
        </p>
    </InfoMessageBox>
</aside>

Ta gjerne en titt p친 _Labels_ og se om noen av dem er relevante for pull requesten din. Som _Reviewers_ kan du bruke forslagene fra GitHub om du vil, eller velge en kollega fra teamet ditt.

### Automatiske sjekker

GitHub fanger opp n친r det lages en pull request, eller det pushes endringer til en branch som har en 친pen PR. N친r dette skjer kj칮res det en _workflow_ p친 GitHub Actions. Workflowen s칮rger for 친 bygge prosjektet, kj칮re enhetstester, visuelle regresjonstester, og publisere en forh친ndsvisning av [jokul.fremtind.no](https://jokul.fremtind.no) med endringene dine.

Du kan f칮lge med p친 workflowen [i Actions-fanen p친 GitHub](https://github.com/fremtind/jokul/actions/workflows/pull_request.yml). Der kan du ogs친 se at kj칮retiden for hele workflowen vanligvis ligger p친 mellom **15-20 minutter**.

### Hvem skal godkjenne pull requesten?

Vi har ikke noen regler for _hvem_ som skal godkjenne en endring, annet enn at minst 칠n kollega m친 gi en _Approve_ og at de automatiske sjekkene m친 kj칮re uten feil. Hvis du gj칮r en stor endring eller introduserer en ny komponent er det fint om du venter litt s친 flere f친r muligheten til 친 gj칮re en review. Bruk magef칮lelsen!

Kjerneteamet f친r varsler i GitHub n친r det kommer nye pull requests og kommer kanskje med en review uoppfordret, men sett gjerne `wkillerud` og `piofinn` eksplisitt som reviewers. Du trenger ikke vente p친 at alle reviewers gir svar.

### Hvor lenge m친 du vente?

Hvor lang tid det tar fra en pull request blir laget til den er reviewet og merget varierer, men de fleste vil bli reviewet og merget innen en arbeidsdag. Hvis en pull request introduserer en ny komponent eller st칮rre endringer kan det ta noen dager med iterasjoner f칮r en pull request blir godkjent og merget.

## Publisering av endringer

N친r en pull request merges til `main` skjer det en automatisk publisering. Her f친r vi endelig uttelling for jobben som blir gjort med 친 skrive commit-meldinger p친 m친ten vi gj칮r i [Lag en commit](#lag-en-commit).

Vi bruker [GitHub Actions](https://github.com/fremtind/jokul/actions/workflows/release.yml) p친 en liknende m친te som ved pull requests. N친r workflowen er ferdig finner du oppdaterte pakker p친 [npmjs.com](https://www.npmjs.com/search?q=keywords%3Afremtind) og [GitHub Packages](https://github.com/orgs/fremtind/packages?repo_name=jokul). Versjonsnummeret blir bestemt av Lerna, som bruker commitmeldingene for 친 bestemme om det skal lages en ny _major_, _minor_, eller _patch_-versjon. Pakkenes `CHANGELOG.md` blir oppdatert med innholdet fra commitmeldinger. I tillegg har det blitt publisert en oppdatert versjon av [jokul.fremtind.no](https://jokul.fremtind.no).

## Kort om infrastrukturen til J칮kul

Vi organiserer koden i et monorepo og bruker [Lerna](https://github.com/lerna/lerna) for 친 holde kontroll p친 de individuelle pakkene i repositoriet. Hver enkelt pakke f칮lger [semantisk versjonering](https://semver.org). Nye versjoner og Changelog blir automatisk generert fra commit-loggen basert p친 [Conventional commits](https://www.conventionalcommits.org/en/v1.0.0/).

Dokumentasjon skrives i `MDX`-filer, og disse ligger i egne `documentation`-mapper sammen med koden til pakkene. Dokumentasjon som ikke har med komponenter 친 gj칮re ligger i `portal`-mappen, under `src/texts`. All dokumentasjonen leses av [Gatsby](https://www.gatsbyjs.com/), som genererer [jokul.fremtind.no](https://jokul.fremtind.no). Siden publiseres med GitHub Pages.

### Slik lager du en ny pakke

1. G친 til rot, kj칮r kommandoen `yarn scaffold`, og f칮lg instruksene i terminalen.
2. Etter kommandoen har kj칮rt vil det v칝re opprettet to mapper i packages mappen (komponent-navn og komponent-navn-react).

Vi har noen minstekrav til dokumentasjon som den nye komponenten din **m친** f칮lge. Disse kravene gjelder dokumentasjonen som vises under Komponenter. I tillegg **m친** det ligge en Figma-branch klar til 친 merges inn i [J칮kul-biblioteket](https://www.figma.com/file/y9JtTf3whfTCHCdYSUXVQ5/J%C3%B8kul-bibliotek-2.0?node-id=0%3A1) som dokumenterer komponenten og alle varianter. Tiden mellom merging av kode og merging av design m친 v칝re s친 kort som mulig.

**M친**-krav:

-   Ingress med kort beskrivelse av komponenten
-   F칮rste eksempel synlig uten 친 scrolle
-   Relevante eksempler p친 riktig og feil bruk
-   Live kodeeksempel (oppdateres med valgte egenskaper)
-   React-props for komponentene i bunnen

I tillegg har vi noen _vil_-칮nsker. Disse er det fint om du har med fordi de gj칮r det lettere for andre 친 bruke komponenten, men de er ikke et krav.

-   Kontrollsp칮rsm친l for bruk
-   Lenker til relevante eller alternative komponenter der det er naturlig
-   Eksempler p친 bruk ute i teamene

Du kan se p친 dokumentasjonen for [Tag](/komponenter/tag) og [Alert message](/komponenter/alertmessage) for inspirasjon.

### Slik lenker du pakker sammen

Hvis du vil legge til en pakke i en annen, kan du fra hvor som helst i prosjektet kj칮re `yarn lerna add <pakke-som-skal-legges-til> --scope=<pakken-den-skal-inn-i>`. For eksempel vil `yarn lerna add @fremtind/jkl-core scope=@fremtind/jkl-button` legge til `jkl-core` som en avhengighet i `jkl-button`-pakken. N친r du legger til avhengigheter p친 denne m친ten, kan Lerna bruke den lokale versjonen av `jkl-core` i stedet for 친 laste ned fra NPM, slik at du kan utvikle raskere. Dette fungerer bare for andre pakker i J칮kul.

### Slik legger du til en avhengighet

Det finnes avhengigheter p친 ulike niv친er i J칮kul. Globale avhengigheter, for eksempel de som trengs til 친 kj칮re en byggejobb, ligger p친 rotniv친. Du kan legge til en ny pakke p친 rotniv친, med kommandoen `yarn add pakke -W`. For 친 legge til som en utviklingsavhengighet bruker du `-DW`.

Lokale avhengigheter, som trengs for at en pakke skal fungere i bruk, legger vi vanligvis p친 pakkeniv친. Se "Slik lenker du pakker sammen". Bruk kommandoen `yarn add` for 친 legge til pakker som ikke er en del av J칮kul. Alternativt kan du bruke [`lerna add`](https://github.com/lerna/lerna/tree/main/commands/add#readme). F칮r du gj칮r det, er det lurt 친 tenke p친 om de skal sendes med komponenten eller om brukeren av komponenten har ansvaret for 친 ha avhengigheten i sitt prosjekt. React b칮r for eksempel v칝re en `peerDependency`, slik at brukeren ikke ender opp med flere utgaver av React i sin pakke.

## Les mer

-   Tester: [Kom i gang med tester](/komigang/tester)
-   Portalen: [Dokumentasjon til portalen](/komigang/portalen)
