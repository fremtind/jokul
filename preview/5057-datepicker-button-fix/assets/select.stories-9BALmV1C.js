import{r as t,R as s}from"./index-siqcju79.js";import{c as te}from"./clsx-B-dksMZM.js";import{u as he}from"./useAnimatedHeight-BiaBG1a8.js";import{u as ke}from"./useId-CahK3IZ3.js";import{u as we}from"./useListNavigation-Bf1PKTdz.js";import{u as ne}from"./usePreviousValue-f0kyfTHz.js";import{A as Ee}from"./ArrowVerticalAnimated-BAkArw06.js";import{I as Se}from"./InputGroup-BJwbXp8L.js";import"./_commonjsHelpers-DaWZu8wl.js";import"./tokens-CvksrKef.js";import"./useBrowserPreferences-B9LcbCiO.js";import"./ArrowUpIcon-CFNLzgG_.js";import"./Icon-mINJCSxV.js";import"./Label-tZYmh4ng.js";import"./SupportLabel-Bm3W2hYF.js";import"./ErrorIcon-BUXYVAIL.js";import"./WarningIcon-CnuYLHnq.js";function _e(l){return typeof l=="string"?{value:l,label:l}:l}function re(l=""){return l.toLowerCase().replace(/[\W_]+/g,"")}function j(l,p){let f=null;p&&(f=l.querySelector('[aria-selected="true"]:not([hidden])')),(!p||!f)&&(f=l.querySelector('[role="option"]')),f?.focus(),l.scrollTop=f?.offsetTop||0}const Pe=()=>{},V=t.forwardRef((l,p)=>{const{id:f,name:m,items:P,value:i,label:H,labelProps:ae,onChange:F,onBlur:D,onFocus:L,className:se,helpLabel:le,errorLabel:U,invalid:oe,searchable:C=!1,inline:W=!1,defaultPrompt:z="Velg",density:ie,width:ue,maxShownOptions:ce=5,style:de,tooltip:w,...pe}=l,c=ke(f||"jkl-select",{generateSuffix:!f}),J=`${c}_label`,x=`${c}_button`,N=`${c}_search-input`,[o,b]=t.useState(!1),A=t.useCallback(()=>{b(e=>!e)},[]),u=!!C,E=u&&o,[h,O]=t.useState(""),Q=t.useCallback(e=>e.label.toLowerCase().includes(h.toLowerCase())?!0:typeof C=="function"?C(h,e):!1,[C,h]),k=t.useMemo(()=>P.map(_e).map(e=>{const r=!u||h===""||Q(e);return{...e,visible:r}}),[P,u,h,Q]),R=t.useMemo(()=>typeof i>"u"?!1:P.some(e=>typeof e=="string"?e===i:e.value===i),[i,P]),[a,S]=t.useState(R&&i!==void 0?i:""),X=a!=="",Y=t.useMemo(()=>k.find(e=>e.value===a)?.label||z,[k,a,z]),_=t.useRef(null),fe=t.useCallback(e=>{_.current=e,p&&(typeof p=="function"?p(e):p.current=e),e&&S(e.value)},[p]),Z=ne(i);t.useEffect(()=>{i!==Z&&S(typeof i>"u"||!R?"":i)},[i,Z,R]);const me=t.useCallback(e=>{const r=e.value;O(""),S(r),A(),v.current?.focus()},[A]),$=ne(a);t.useEffect(()=>{typeof $>"u"||$===a||a===i||(F&&F({type:"change",target:{name:m,value:a}}),_.current&&_.current.dispatchEvent(new Event("change",{bubbles:!0})))},[F,m,i,a,$]);const B=t.useRef(null),T=t.useRef(!1),d=t.useRef(null),v=t.useRef(null),ee=t.useCallback((e,r)=>{if(e&&!u){const n=r.current;n&&j(n,a)}else e?d.current&&d.current.focus():T.current&&v.current&&v.current.focus()},[u,a]),[g]=he(o,{onFirstVisible:ee,onTransitionEnd:ee});we({ref:g});const K=t.useCallback(()=>{u&&O(""),D&&(D({type:"blur",target:{name:m,value:a}}),_.current?.dispatchEvent(new Event("focusout",{bubbles:!0}))),T.current=!1,b(!1)},[D,u,m,a]),M=t.useCallback(e=>{B.current?.contains(e.relatedTarget)||K()},[K]),G=t.useCallback(()=>{T.current||(L&&L({type:"change",target:{name:m,value:a}}),T.current=!0)},[L,a,m]),ve=t.useCallback(e=>{e.target.focus({preventScroll:!0})},[]);t.useEffect(()=>{const e=_.current,r=d.current,n=v.current,q=B.current;return e?.addEventListener("focus",()=>{E?r?.focus():n?.focus()}),e?.addEventListener("blur",function(y){q?.contains(y.relatedTarget)&&y.preventDefault()}),()=>{e?.removeEventListener("focus",()=>{E?r?.focus():n?.focus()}),e?.removeEventListener("blur",function(y){q?.contains(y.relatedTarget)&&y.preventDefault()})}},[E]);const ge=t.useCallback(e=>{(e.key==="ArrowDown"||e.key===" ")&&!o?(e.preventDefault(),e.stopPropagation(),b(!0)):e.key==="Escape"&&(e.preventDefault(),e.stopPropagation(),b(!1))},[o]),be=t.useCallback(e=>{if(e.key==="ArrowDown"){e.preventDefault(),e.stopPropagation();const r=g.current;r&&(u?j(r,void 0):j(r,a))}else if(e.key==="Escape")e.preventDefault(),e.stopPropagation(),b(!1);else if(e.key==="Tab"&&!e.shiftKey){const r=g.current;r&&(e.preventDefault(),e.stopPropagation(),j(r,a))}else e.key==="Enter"&&o&&(e.preventDefault(),e.stopPropagation())},[g,a,u,o]),ye=t.useCallback(e=>{if(e.key==="Tab")e.preventDefault(),e.stopPropagation(),e.shiftKey&&d.current?d.current.focus():v.current&&(S(e.currentTarget.value),b(!1),v.current.focus());else if(e.key==="ArrowUp"&&g.current&&d.current){const r=g.current.querySelector('[role="option"]:not([hidden])');e.currentTarget.id===r?.id&&d.current&&d.current.focus()}},[g]);return t.useEffect(()=>{const e=r=>{r.key==="Escape"&&o&&b(!1)};return typeof window<"u"&&o&&window.addEventListener("keydown",e),()=>{typeof window<"u"&&window.removeEventListener("keydown",e)}},[o]),s.createElement(s.Fragment,null,s.createElement("select",{name:m,tabIndex:-1,"data-testid":"jkl-native-select",className:"jkl-sr-only","aria-hidden":!0,ref:fe,value:a,onChange:Pe},s.createElement("option",{value:""})," ",k.map(e=>s.createElement("option",{key:`${c}-opt-${e.value}`,hidden:!e.visible,value:e.value},e.label))),s.createElement(Se,{ref:B,"data-testid":"jkl-select",className:te("jkl-select",se,{"jkl-select--inline":W,"jkl-select--open":o&&k.some(e=>e.visible),"jkl-select--no-value":!X,"jkl-select--invalid":!!U||oe}),tooltip:w&&s.isValidElement(w)?s.cloneElement(w,{triggerProps:{...w.props.triggerProps,onFocus:e=>{w.props.triggerProps?.onFocus?.(e),K()}}}):null,...pe,id:u?N:x,style:{"--jkl-select-max-shown-options":ce,...de},density:ie,label:H,labelProps:{id:J,srOnly:W,...ae,htmlFor:u?N:x},helpLabel:le,errorLabel:U,render:({"aria-invalid":e,...r})=>s.createElement("div",{className:"jkl-select__outer-wrapper",style:{width:ue}},u&&s.createElement("input",{...r,"aria-invalid":e,id:N,hidden:!E,ref:d,placeholder:"Søk",value:h,onChange:n=>O(n.target.value),"data-testid":"jkl-select__search-input",className:"jkl-select__search-input","aria-autocomplete":"list","aria-activedescendant":X?`${c}__${re(a)}`:void 0,"aria-controls":c,"aria-expanded":o,role:"combobox",onKeyDown:be,onBlur:M,onFocus:G,onClick:n=>{n.stopPropagation()}}),s.createElement("button",{"aria-invalid":e,...r,id:x,ref:v,hidden:E,type:"button",name:`${m}-btn`,className:te("jkl-select__button",{"jkl-select__button--active-value":!!a}),"data-testid":"jkl-select__button","aria-label":`${Y||"Velg"},${H}`,"aria-expanded":o,"aria-controls":c,onBlur:M,onFocus:G,onKeyDown:ge,onClick:A,onMouseDown:n=>{n.preventDefault(),v.current?.focus()}},Y),s.createElement("div",{id:c,ref:g,role:"listbox",className:"jkl-select__options-menu",hidden:!o||k.every(n=>!n.visible),"aria-labelledby":J,tabIndex:-1,"data-focus":"controlled"},k.map((n,q)=>n.visible?s.createElement("button",{key:`${c}-${n.value}`,hidden:!n.visible,type:"button",id:`${c}__${re(n.value)}`,className:"jkl-select__option","data-testid":"jkl-select__option","aria-selected":n.value===a,role:"option",value:n.value,"data-testautoid":`jkl-select__option-${q}`,onBlur:M,onFocus:G,onKeyDown:ye,onClick:y=>{y.preventDefault(),me(n)},onMouseOver:ve},n.label,n.description?s.createElement("span",{className:"jkl-select__option-description"},n.description):null):null)),s.createElement(Ee,{variant:"medium",pointingDown:!o,className:"jkl-select__arrow"}))}))});V.displayName="Select";V.__docgenInfo={description:"",methods:[],displayName:"Select",props:{"data-testautoid":{required:!1,tsType:{name:"string"},description:""},id:{required:!1,tsType:{name:"string"},description:""},name:{required:!0,tsType:{name:"string"},description:""},label:{required:!0,tsType:{name:"string"},description:""},labelProps:{required:!1,tsType:{name:"Omit",elements:[{name:"LabelProps"},{name:"union",raw:'"children" | "density" | "htmlFor" | "standAlone"',elements:[{name:"literal",value:'"children"'},{name:"literal",value:'"density"'},{name:"literal",value:'"htmlFor"'},{name:"literal",value:'"standAlone"'}]}],raw:`Omit<
    LabelProps,
    "children" | "density" | "htmlFor" | "standAlone"
>`},description:""},items:{required:!0,tsType:{name:"Array",elements:[{name:"union",raw:"string | ValuePair",elements:[{name:"string"},{name:"signature",type:"object",raw:`{
    value: string;
    label: string;
    description?: string;
}`,signature:{properties:[{key:"value",value:{name:"string",required:!0}},{key:"label",value:{name:"string",required:!0}},{key:"description",value:{name:"string",required:!1}}]}}]}],raw:"Array<string | ValuePair>"},description:""},inline:{required:!1,tsType:{name:"boolean"},description:"@default false"},defaultPrompt:{required:!1,tsType:{name:"string"},description:'@default "Velg"'},className:{required:!1,tsType:{name:"string"},description:""},value:{required:!1,tsType:{name:"string"},description:""},helpLabel:{required:!1,tsType:{name:"string"},description:""},errorLabel:{required:!1,tsType:{name:"string"},description:""},searchable:{required:!1,tsType:{name:"union",raw:`| boolean
| ((searchValue: string, searchItem: string | ValuePair) => boolean)`,elements:[{name:"boolean"},{name:"unknown"}]},description:"@default false"},density:{required:!1,tsType:{name:"union",raw:'"comfortable" | "compact"',elements:[{name:"literal",value:'"comfortable"'},{name:"literal",value:'"compact"'}]},description:""},width:{required:!1,tsType:{name:"string"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:`(
    event: SelectPartialChangeEvent,
) => void`,signature:{arguments:[{type:{name:"SelectPartialChangeEvent"},name:"event"}],return:{name:"void"}}},description:""},onBlur:{required:!1,tsType:{name:"signature",type:"function",raw:`(
    event: SelectPartialChangeEvent,
) => void`,signature:{arguments:[{type:{name:"SelectPartialChangeEvent"},name:"event"}],return:{name:"void"}}},description:""},onFocus:{required:!1,tsType:{name:"signature",type:"function",raw:`(
    event: SelectPartialChangeEvent,
) => void`,signature:{arguments:[{type:{name:"SelectPartialChangeEvent"},name:"event"}],return:{name:"void"}}},description:""},invalid:{required:!1,tsType:{name:"boolean"},description:`Merk som ugyldig uten å sende inn en errorLabel.
NB! Brukes kun i tilfeller der valideringsfeil dukker opp andre steder, for eksempel i en FieldGroup.`},maxShownOptions:{required:!1,tsType:{name:"number"},description:`Hvor mange valg skal vises i listen før den begynner å scrolle.
@default 5`}},composes:["Omit"]};const Ge={title:"Komponenter/Select",component:V,parameters:{layout:"padded"},tags:["autodocs"]},Ce={name:"Select",label:"Hvilket merke er telefonen?",items:[{value:"Apple",label:"Apple"},{value:"Samsung",label:"Samsung"},{value:"Google",label:"Google"},{value:"OnePlus",label:"OnePlus"},{value:"Nokia",label:"Nokia"}]},I={args:Ce,render:({...l})=>s.createElement(V,{...l})};I.parameters={...I.parameters,docs:{...I.parameters?.docs,source:{originalSource:`{
  args: baseArgs,
  render: ({
    ...props
  }) => <Select {...props} />
}`,...I.parameters?.docs?.source}}};const He=["SelectStory"];export{I as SelectStory,He as __namedExportsOrder,Ge as default};
