import{r as d,j as n,R as b}from"./iframe-CwaNc35c.js";import{B as j}from"./Button-s05weEm0.js";import{R as M}from"./index-RM4x3A-V.js";import{M as E,a as _,b as I,c as N,d as S,f as R,g as D}from"./Modal-DFrEPCYt.js";import{u as q}from"./useModal-d_WGbgEP.js";import{F as P}from"./Flex-DzyOX7bQ.js";import{L as A}from"./Link-vigbTEZs.js";import"./preload-helper-PPVm8Dsz.js";import"./clsx-B-dksMZM.js";import"./usePreviousValue-Bp80Hyoy.js";import"./Loader-DdZBxgVh.js";import"./useDelayedRender-BlEJBBmT.js";import"./index-DVdOHpc9.js";import"./IconButton-Blc1-ANO.js";import"./CloseIcon-CWBbx2gN.js";import"./Icon-DfjqDqJi.js";import"./index-Chjiymov.js";import"./useId-BZNJbNDa.js";import"./tokens-d2GYn7oW.js";import"./SlotComponent-BRhprlG7.js";import"./mergeRefs-DD3P5IDs.js";const F=e=>{if(typeof document>"u")return;const t=document.cookie.split(";").map(o=>o.trim().split("=")).find(o=>o[0]===e);if(t)return t},L=({adapter:e,name:t})=>{const o=F(t);if(o)return JSON.parse(o[1]);if(e)return e()},$=10368e3,J=({consent:e,maxAge:t=$,name:o,domain:a,path:i})=>{document.cookie=[`${o}=${JSON.stringify(e)}`,`max-age=${t}`,"SameSite=Lax",!!a&&`domain=${a}`,!!i&&`path=${i}`].filter(c=>c).join(";")},K=(e,t)=>{if(!t)return Object.values(e).some(i=>i);const o=new Map(Object.entries(t)),a=Object.entries(e);for(const[i,c]of a)if(c&&o.get(i)===null)return!0;return!1},U=({functional:e,statistics:t})=>({...e&&{functional:e},...t&&{statistics:t}}),H="fremtind-cookie-consent",h=b.createContext(void 0),B=({children:e,cookieAdapter:t,functional:o,statistics:a,cookieName:i=H,cookieDomain:c,cookiePath:m})=>{const[g,p]=d.useState(()=>Date.now()),k=d.useMemo(()=>U({functional:o,statistics:a}),[o,a]),f=d.useMemo(()=>L({adapter:t,name:i})??{functional:null,statistics:null},[t,i,g]),[r,l]=d.useState(()=>K(k,f));return n.jsx(h.Provider,{value:{isOpen:r,setIsOpen:l,updateCurrentConsents:()=>p(Date.now()),requirement:k,currentConsent:f,cookieName:i,cookieDomain:c,cookiePath:m},children:e})},V=()=>{const e=b.useContext(h);if(e===void 0)throw new Error("CookieConsent must be used within a CookieConsentProvider");return e},G=()=>{const e=d.useContext(h);if(e===void 0)throw new Error("useCookieConsent must be used within a CookieConsentProvider");const t=()=>{e.setIsOpen(!0)},o=e.currentConsent;return{openConsentModal:t,consents:o}};B.__docgenInfo={description:"",methods:[],displayName:"CookieConsentProvider",props:{children:{required:!0,tsType:{name:"union",raw:"ReactNode | ReactNode[]",elements:[{name:"ReactNode"},{name:"Array",elements:[{name:"ReactNode"}],raw:"ReactNode[]"}]},description:""},cookieAdapter:{required:!1,tsType:{name:"signature",type:"function",raw:"() => Consent | undefined",signature:{arguments:[],return:{name:"union",raw:"Consent | undefined",elements:[{name:"signature",type:"object",raw:`{
    functional?: ConsentState;
    statistics?: ConsentState;
}`,signature:{properties:[{key:"functional",value:{name:"union",raw:'null | "denied" | "accepted"',elements:[{name:"null"},{name:"literal",value:'"denied"'},{name:"literal",value:'"accepted"'}],required:!1}},{key:"statistics",value:{name:"union",raw:'null | "denied" | "accepted"',elements:[{name:"null"},{name:"literal",value:'"denied"'},{name:"literal",value:'"accepted"'}],required:!1}}]}},{name:"undefined"}]}}},description:""},cookieName:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'"fremtind-cookie-consent"',computed:!1}},cookieDomain:{required:!1,tsType:{name:"string"},description:""},cookiePath:{required:!1,tsType:{name:"string"},description:""}}};const v=({blocking:e,onAccept:t,aboutPage:o="https://www.fremtind.no/informasjonskapsler",...a})=>{const{currentConsent:i,cookieName:c,cookieDomain:m,cookiePath:g,isOpen:p,setIsOpen:k,updateCurrentConsents:f}=V(),[r,l]=q({id:`jkl-cookie-modal-${d.useId()}`,role:e?"alertdialog":"dialog",title:"Informasjonskapsler"});if(d.useEffect(()=>{p?r?.show():r?.hide()},[r,p]),d.useEffect(()=>{const u=()=>k(!1);return r?.on("hide",u),()=>{r?.off("hide",u)}},[r,k]),typeof document>"u")return null;if(typeof navigator<"u"&&!navigator.cookieEnabled)return t&&t({functional:"denied",statistics:"denied"}),null;const x=u=>{const O={...i,functional:u,statistics:u};J({consent:O,name:c,domain:m,path:g}),f(),r?.hide()},T=u=>{u.preventDefault(),x("denied")};return M.createPortal(n.jsxs(E,{...l.container,...a,"data-cookie-consent-open":p,children:[n.jsx(_,{...l.overlay}),n.jsx(I,{component:"form",...l.modal,onSubmit:T,children:n.jsxs("form",{children:[n.jsx(N,{children:n.jsx(S,{...l.title,children:"Får vi bruke valgfrie informasjonskapsler?"})}),n.jsx(R,{children:n.jsxs(P,{direction:"column",gap:"m",children:[n.jsx("p",{children:"Vi ønsker å samle anonym statistikk for å forstå hvordan nettsidene våre brukes. Det hjelper oss til å gjøre innhold og løsninger bedre og mer brukervennlige."}),n.jsxs("p",{children:[n.jsx(A,{href:o,target:"_blank",children:"Les mer om hvilke informasjonskapsler vi lagrer her"}),"."]})]})}),n.jsxs(D,{children:[n.jsx(j,{variant:"secondary","data-testid":"jkl-cookie-consent-godta-alle",type:"button",onClick:()=>x("accepted"),children:"Ja, det er greit"}),n.jsx(j,{variant:"secondary","data-testid":"jkl-cookie-consent-nekt-alle",type:"button",onClick:()=>x("denied"),children:"Nei takk"})]})]})})]}),document.body)},{expect:s,screen:y,waitFor:W}=__STORYBOOK_MODULE_TEST__,X=({children:e})=>{const{openConsentModal:t}=G();return n.jsxs("div",{children:[n.jsx(j,{onClick:()=>t(),"data-testid":"open-button",children:"Åpne samtykker"}),e]})},we={title:"Komponenter/CookieConsent",component:B,subcomponents:{CookieConsent:v},args:{cookieName:"demo-consent-cookie",functional:!0,statistics:!0,children:n.jsx(X,{children:n.jsx(v,{aboutPage:"https://www.fremtind.no/informasjonskapsler"})})}},C={},w={tags:["test"],play:async({canvas:e,userEvent:t,step:o})=>{const a=e.getByTestId("open-button");await o("Åpne modal",async()=>{await t.click(a),await W(()=>{const m=y.getByRole("document");s(m).toBeInTheDocument()})});const i=y.getByTestId("jkl-cookie-consent-godta-alle"),c=y.getByTestId("jkl-cookie-consent-nekt-alle");await o("Aksepter cookies",async()=>{await t.click(i),await s(document.cookie).toContain('"functional":"accepted"'),await s(document.cookie).toContain('"statistics":"accepted"'),await s(document.cookie).not.toContain('"statistics":"denied"'),await s(document.cookie).not.toContain('"functional":"denied"')}),await o("Nekt cookies",async()=>{await t.click(c),await s(document.cookie).toContain('"functional":"denied"'),await s(document.cookie).toContain('"statistics":"denied"'),await s(document.cookie).not.toContain('"statistics":"accepted"'),await s(document.cookie).not.toContain('"functional":"accepted"')}),await o("Nekt cookies dersom man klikker utenfor",async()=>{await t.click(a),await s(document.cookie).toContain('"functional":"denied"'),await s(document.cookie).toContain('"statistics":"denied"'),await s(document.cookie).not.toContain('"statistics":"accepted"'),await s(document.cookie).not.toContain('"functional":"accepted"')})}};C.parameters={...C.parameters,docs:{...C.parameters?.docs,source:{originalSource:"{}",...C.parameters?.docs?.source}}};w.parameters={...w.parameters,docs:{...w.parameters?.docs,source:{originalSource:`{
  tags: ["test"],
  play: async ({
    canvas,
    userEvent,
    step
  }) => {
    const openCookieConsentButton = canvas.getByTestId("open-button");
    await step("Åpne modal", async () => {
      await userEvent.click(openCookieConsentButton);
      await waitFor(() => {
        const modal = screen.getByRole("document");
        expect(modal).toBeInTheDocument();
      });
    });
    const acceptButton = screen.getByTestId("jkl-cookie-consent-godta-alle");
    const rejectButton = screen.getByTestId("jkl-cookie-consent-nekt-alle");
    await step("Aksepter cookies", async () => {
      await userEvent.click(acceptButton);
      await expect(document.cookie).toContain('"functional":"accepted"');
      await expect(document.cookie).toContain('"statistics":"accepted"');
      await expect(document.cookie).not.toContain('"statistics":"denied"');
      await expect(document.cookie).not.toContain('"functional":"denied"');
    });
    await step("Nekt cookies", async () => {
      await userEvent.click(rejectButton);
      await expect(document.cookie).toContain('"functional":"denied"');
      await expect(document.cookie).toContain('"statistics":"denied"');
      await expect(document.cookie).not.toContain('"statistics":"accepted"');
      await expect(document.cookie).not.toContain('"functional":"accepted"');
    });
    await step("Nekt cookies dersom man klikker utenfor", async () => {
      await userEvent.click(openCookieConsentButton);
      await expect(document.cookie).toContain('"functional":"denied"');
      await expect(document.cookie).toContain('"statistics":"denied"');
      await expect(document.cookie).not.toContain('"statistics":"accepted"');
      await expect(document.cookie).not.toContain('"functional":"accepted"');
    });
  }
}`,...w.parameters?.docs?.source}}};const ge=["_CookieConsent","CookieTest"];export{w as CookieTest,C as _CookieConsent,ge as __namedExportsOrder,we as default};
