import{c as Z}from"./clsx-B-dksMZM.js";import{r as t,R as s}from"./index-siqcju79.js";import{u as ye}from"./useAnimatedHeight-RiQMQofH.js";import{u as he}from"./useId-CahK3IZ3.js";import{u as ke}from"./useListNavigation-Bf1PKTdz.js";import{u as ee}from"./usePreviousValue-f0kyfTHz.js";import{g as we}from"./valuePair-Bn6SadUn.js";import{A as Ee}from"./ArrowVerticalAnimated-CU3StSif.js";import{I as _e}from"./InputGroup-DvEXDYVz.js";function te(g=""){return g.toLowerCase().replace(/[\W_]+/g,"")}function j(g,d){let p=null;d&&(p=g.querySelector('[aria-selected="true"]:not([hidden])')),(!d||!p)&&(p=g.querySelector('[role="option"]')),p?.focus(),g.scrollTop=p?.offsetTop||0}const Ce=()=>{},ne=t.forwardRef((g,d)=>{const{id:p,name:f,items:T,value:o,label:M,labelProps:ae,onChange:I,onBlur:V,onFocus:F,className:re,helpLabel:se,errorLabel:G,invalid:le,searchable:P=!1,inline:H=!1,defaultPrompt:U="Velg",density:oe,width:ie,maxShownOptions:ue=5,style:ce,tooltip:w,...de}=g,u=he(p||"jkl-select",{generateSuffix:!p}),W=`${u}_label`,D=`${u}_button`,L=`${u}_search-input`,[l,b]=t.useState(!1),x=t.useCallback(()=>{b(e=>!e)},[]),i=!!P,E=i&&l,[h,N]=t.useState(""),z=t.useCallback(e=>e.label.toLowerCase().includes(h.toLowerCase())?!0:typeof P=="function"?P(h,e):!1,[P,h]),k=t.useMemo(()=>T.map(we).map(e=>{const a=!i||h===""||z(e);return{...e,visible:a}}),[T,i,h,z]),R=t.useMemo(()=>typeof o>"u"?!1:T.some(e=>typeof e=="string"?e===o:e.value===o),[o,T]),[r,_]=t.useState(R&&o!==void 0?o:""),J=r!=="",Q=t.useMemo(()=>k.find(e=>e.value===r)?.label||U,[k,r,U]),C=t.useRef(null),pe=t.useCallback(e=>{C.current=e,d&&(typeof d=="function"?d(e):d.current=e),e&&_(e.value)},[d]),X=ee(o);t.useEffect(()=>{o!==X&&_(typeof o>"u"||!R?"":o)},[o,X,R]);const fe=t.useCallback(e=>{const a=e.value;N(""),_(a),x(),m.current?.focus()},[x]),$=ee(r);t.useEffect(()=>{typeof $>"u"||$===r||r===o||(I&&I({type:"change",target:{name:f,value:r}}),C.current&&C.current.dispatchEvent(new Event("change",{bubbles:!0})))},[I,f,o,r,$]);const A=t.useRef(null),S=t.useRef(!1),c=t.useRef(null),m=t.useRef(null),Y=t.useCallback((e,a)=>{if(e&&!i){const n=a.current;n&&j(n,r)}else e?c.current&&c.current.focus():S.current&&m.current&&m.current.focus()},[i,r]),[v]=ye(l,{onFirstVisible:Y,onTransitionEnd:Y});ke({ref:v});const O=t.useCallback(()=>{i&&N(""),V&&(V({type:"blur",target:{name:f,value:r}}),C.current?.dispatchEvent(new Event("focusout",{bubbles:!0}))),S.current=!1,b(!1)},[V,i,f,r]),B=t.useCallback(e=>{A.current?.contains(e.relatedTarget)||O()},[O]),K=t.useCallback(()=>{S.current||(F&&F({type:"change",target:{name:f,value:r}}),S.current=!0)},[F,r,f]),me=t.useCallback(e=>{e.target.focus({preventScroll:!0})},[]);t.useEffect(()=>{const e=C.current,a=c.current,n=m.current,q=A.current;return e?.addEventListener("focus",()=>{E?a?.focus():n?.focus()}),e?.addEventListener("blur",function(y){q?.contains(y.relatedTarget)&&y.preventDefault()}),()=>{e?.removeEventListener("focus",()=>{E?a?.focus():n?.focus()}),e?.removeEventListener("blur",function(y){q?.contains(y.relatedTarget)&&y.preventDefault()})}},[E]);const ve=t.useCallback(e=>{(e.key==="ArrowDown"||e.key===" ")&&!l?(e.preventDefault(),e.stopPropagation(),b(!0)):e.key==="Escape"&&(e.preventDefault(),e.stopPropagation(),b(!1))},[l]),ge=t.useCallback(e=>{if(e.key==="ArrowDown"){e.preventDefault(),e.stopPropagation();const a=v.current;a&&(i?j(a,void 0):j(a,r))}else if(e.key==="Escape")e.preventDefault(),e.stopPropagation(),b(!1);else if(e.key==="Tab"&&!e.shiftKey){const a=v.current;a&&(e.preventDefault(),e.stopPropagation(),j(a,r))}else e.key==="Enter"&&l&&(e.preventDefault(),e.stopPropagation())},[v,r,i,l]),be=t.useCallback(e=>{if(e.key==="Tab")e.preventDefault(),e.stopPropagation(),e.shiftKey&&c.current?c.current.focus():m.current&&(_(e.currentTarget.value),b(!1),m.current.focus());else if(e.key==="ArrowUp"&&v.current&&c.current){const a=v.current.querySelector('[role="option"]:not([hidden])');e.currentTarget.id===a?.id&&c.current&&c.current.focus()}},[v]);return t.useEffect(()=>{const e=a=>{a.key==="Escape"&&l&&b(!1)};return typeof window<"u"&&l&&window.addEventListener("keydown",e),()=>{typeof window<"u"&&window.removeEventListener("keydown",e)}},[l]),s.createElement(s.Fragment,null,s.createElement("select",{name:f,tabIndex:-1,"data-testid":"jkl-native-select",className:"jkl-sr-only","aria-hidden":!0,ref:pe,value:r,onChange:Ce},s.createElement("option",{value:""})," ",k.map(e=>s.createElement("option",{key:`${u}-opt-${e.value}`,hidden:!e.visible,value:e.value},e.label))),s.createElement(_e,{ref:A,"data-testid":"jkl-select",className:Z("jkl-select",re,{"jkl-select--inline":H,"jkl-select--open":l&&k.some(e=>e.visible),"jkl-select--no-value":!J,"jkl-select--invalid":!!G||le}),tooltip:w&&s.isValidElement(w)?s.cloneElement(w,{triggerProps:{...w.props.triggerProps,onFocus:e=>{w.props.triggerProps?.onFocus?.(e),O()}}}):null,...de,id:i?L:D,style:{"--jkl-select-max-shown-options":ue,...ce},density:oe,label:M,labelProps:{id:W,srOnly:H,...ae,htmlFor:i?L:D},helpLabel:se,errorLabel:G,render:({"aria-invalid":e,...a})=>s.createElement("div",{className:"jkl-select__outer-wrapper",style:{width:ie}},i&&s.createElement("input",{...a,"aria-invalid":e,id:L,hidden:!E,ref:c,placeholder:"Søk",value:h,onChange:n=>N(n.target.value),"data-testid":"jkl-select__search-input",className:"jkl-select__search-input","aria-autocomplete":"list","aria-activedescendant":J?`${u}__${te(r)}`:void 0,"aria-controls":u,"aria-expanded":l,role:"combobox",onKeyDown:ge,onBlur:B,onFocus:K,onClick:n=>{n.stopPropagation()}}),s.createElement("button",{"aria-invalid":e,...a,id:D,ref:m,hidden:E,type:"button",name:`${f}-btn`,className:Z("jkl-select__button",{"jkl-select__button--active-value":!!r}),"data-testid":"jkl-select__button","aria-label":`${Q||"Velg"},${M}`,"aria-expanded":l,"aria-controls":u,onBlur:B,onFocus:K,onKeyDown:ve,onClick:x,onMouseDown:n=>{n.preventDefault(),m.current?.focus()}},Q),s.createElement("div",{id:u,ref:v,role:"listbox",className:"jkl-select__options-menu",hidden:!l||k.every(n=>!n.visible),"aria-labelledby":W,tabIndex:-1,"data-focus":"controlled"},k.map((n,q)=>n.visible?s.createElement("button",{key:`${u}-${n.value}`,hidden:!n.visible,type:"button",id:`${u}__${te(n.value)}`,className:"jkl-select__option","data-testid":"jkl-select__option","aria-selected":n.value===r,role:"option",value:n.value,"data-testautoid":`jkl-select__option-${q}`,onBlur:B,onFocus:K,onKeyDown:be,onClick:y=>{y.preventDefault(),fe(n)},onMouseOver:me},n.label,n.description?s.createElement("span",{className:"jkl-select__option-description"},n.description):null):null)),s.createElement(Ee,{variant:"medium",pointingDown:!l,className:"jkl-select__arrow"}))}))});ne.displayName="Select";ne.__docgenInfo={description:"",methods:[],displayName:"Select",props:{"data-testautoid":{required:!1,tsType:{name:"string"},description:""},id:{required:!1,tsType:{name:"string"},description:""},name:{required:!0,tsType:{name:"string"},description:""},label:{required:!0,tsType:{name:"string"},description:""},labelProps:{required:!1,tsType:{name:"Omit",elements:[{name:"LabelProps"},{name:"union",raw:'"children" | "density" | "htmlFor" | "standAlone"',elements:[{name:"literal",value:'"children"'},{name:"literal",value:'"density"'},{name:"literal",value:'"htmlFor"'},{name:"literal",value:'"standAlone"'}]}],raw:`Omit<
    LabelProps,
    "children" | "density" | "htmlFor" | "standAlone"
>`},description:""},items:{required:!0,tsType:{name:"Array",elements:[{name:"union",raw:"string | ValuePair",elements:[{name:"string"},{name:"signature",type:"object",raw:`{
    value: string;
    label: string;
    description?: string;
}`,signature:{properties:[{key:"value",value:{name:"string",required:!0}},{key:"label",value:{name:"string",required:!0}},{key:"description",value:{name:"string",required:!1}}]}}]}],raw:"Array<string | ValuePair>"},description:""},inline:{required:!1,tsType:{name:"boolean"},description:"@default false"},defaultPrompt:{required:!1,tsType:{name:"string"},description:'@default "Velg"'},className:{required:!1,tsType:{name:"string"},description:""},value:{required:!1,tsType:{name:"string"},description:""},helpLabel:{required:!1,tsType:{name:"string"},description:""},errorLabel:{required:!1,tsType:{name:"string"},description:""},searchable:{required:!1,tsType:{name:"union",raw:`| boolean
| ((searchValue: string, searchItem: string | ValuePair) => boolean)`,elements:[{name:"boolean"},{name:"unknown"}]},description:"@default false"},density:{required:!1,tsType:{name:"union",raw:'"comfortable" | "compact"',elements:[{name:"literal",value:'"comfortable"'},{name:"literal",value:'"compact"'}]},description:""},width:{required:!1,tsType:{name:"string"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:`(
    event: SelectPartialChangeEvent,
) => void`,signature:{arguments:[{type:{name:"SelectPartialChangeEvent"},name:"event"}],return:{name:"void"}}},description:""},onBlur:{required:!1,tsType:{name:"signature",type:"function",raw:`(
    event: SelectPartialChangeEvent,
) => void`,signature:{arguments:[{type:{name:"SelectPartialChangeEvent"},name:"event"}],return:{name:"void"}}},description:""},onFocus:{required:!1,tsType:{name:"signature",type:"function",raw:`(
    event: SelectPartialChangeEvent,
) => void`,signature:{arguments:[{type:{name:"SelectPartialChangeEvent"},name:"event"}],return:{name:"void"}}},description:""},invalid:{required:!1,tsType:{name:"boolean"},description:`Merk som ugyldig uten å sende inn en errorLabel.
NB! Brukes kun i tilfeller der valideringsfeil dukker opp andre steder, for eksempel i en FieldGroup.`},maxShownOptions:{required:!1,tsType:{name:"number"},description:`Hvor mange valg skal vises i listen før den begynner å scrolle.
@default 5`}},composes:["Omit"]};export{ne as S};
