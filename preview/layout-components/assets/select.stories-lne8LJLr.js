import{j as o}from"./jsx-runtime-BbjHj44Y.js";import{r,R as te}from"./index-C6mWTJJr.js";import{c as ne}from"./clsx-B-dksMZM.js";import{u as Se}from"./useAnimatedHeight-CveG_HYh.js";import{u as _e}from"./useId-Cim48cX5.js";import{u as xe}from"./useListNavigation-4EwcpCUj.js";import{u as re}from"./usePreviousValue-ByfnePFg.js";import{A as Pe}from"./ArrowVerticalAnimated-CRKHM97x.js";import{I as Ce}from"./InputGroup-CWudQnz8.js";import"./_commonjsHelpers-BosuxZz1.js";import"./tokens-DyQL8Q6a.js";import"./useBrowserPreferences-Cx8DRHte.js";import"./ArrowUpIcon-DThQXmOF.js";import"./Icon-CZwjvlw8.js";import"./Label-BPOuC4mL.js";import"./SupportLabel-uWZp44mj.js";import"./ErrorIcon-B0wgdey8.js";import"./WarningIcon-B6VvEiHT.js";function Te(s){return typeof s=="string"?{value:s,label:s}:s}function ae(s=""){return s.toLowerCase().replace(/[\W_]+/g,"")}function E(s,m){let u=null;m&&(u=s.querySelector('[aria-selected="true"]:not([hidden])')),(!m||!u)&&(u=s.querySelector('[role="option"]')),u==null||u.focus(),s.scrollTop=(u==null?void 0:u.offsetTop)||0}const Ee=()=>{},D=r.forwardRef((s,m)=>{const{id:u,name:v,items:P,value:i,label:H,labelProps:ie,onChange:V,onBlur:L,onFocus:I,className:ue,helpLabel:ce,errorLabel:U,invalid:de,searchable:C=!1,inline:W=!1,defaultPrompt:z="Velg",density:pe,width:fe,maxShownOptions:me=5,style:ve,tooltip:j,...ge}=s,p=_e(u||"jkl-select",{generateSuffix:!u}),J=`${p}_label`,F=`${p}_button`,N=`${p}_search-input`,[l,y]=r.useState(!1),A=r.useCallback(()=>{y(e=>!e)},[]),c=!!C,S=c&&l,[k,O]=r.useState(""),Q=r.useCallback(e=>e.label.toLowerCase().includes(k.toLowerCase())?!0:typeof C=="function"?C(k,e):!1,[C,k]),w=r.useMemo(()=>P.map(Te).map(e=>{const t=!c||k===""||Q(e);return{...e,visible:t}}),[P,c,k,Q]),$=r.useMemo(()=>typeof i>"u"?!1:P.some(e=>typeof e=="string"?e===i:e.value===i),[i,P]),[a,_]=r.useState($&&i!==void 0?i:""),X=a!=="",Y=r.useMemo(()=>{var e;return((e=w.find(t=>t.value===a))==null?void 0:e.label)||z},[w,a,z]),x=r.useRef(null),be=r.useCallback(e=>{x.current=e,m&&(typeof m=="function"?m(e):m.current=e),e&&_(e.value)},[m]),Z=re(i);r.useEffect(()=>{i!==Z&&_(typeof i>"u"||!$?"":i)},[i,Z,$]);const ye=r.useCallback(e=>{var n;const t=e.value;O(""),_(t),A(),(n=g.current)==null||n.focus()},[A]),B=re(a);r.useEffect(()=>{typeof B>"u"||B===a||a===i||(V&&V({type:"change",target:{name:v,value:a}}),x.current&&x.current.dispatchEvent(new Event("change",{bubbles:!0})))},[V,v,i,a,B]);const K=r.useRef(null),T=r.useRef(!1),f=r.useRef(null),g=r.useRef(null),ee=r.useCallback((e,t)=>{if(e&&!c){const n=t.current;n&&E(n,a)}else e?f.current&&f.current.focus():T.current&&g.current&&g.current.focus()},[c,a]),[b]=Se(l,{onFirstVisible:ee,onTransitionEnd:ee});xe({ref:b});const R=r.useCallback(()=>{var e;c&&O(""),L&&(L({type:"blur",target:{name:v,value:a}}),(e=x.current)==null||e.dispatchEvent(new Event("focusout",{bubbles:!0}))),T.current=!1,y(!1)},[L,c,v,a]),M=r.useCallback(e=>{const t=K.current;(t==null?void 0:t.contains(e.relatedTarget))||R()},[R]),G=r.useCallback(()=>{T.current||(I&&I({type:"change",target:{name:v,value:a}}),T.current=!0)},[I,a,v]),he=r.useCallback(e=>{e.target.focus({preventScroll:!0})},[]);r.useEffect(()=>{const e=x.current,t=f.current,n=g.current,d=K.current;return e==null||e.addEventListener("focus",()=>{S?t==null||t.focus():n==null||n.focus()}),e==null||e.addEventListener("blur",function(h){d!=null&&d.contains(h.relatedTarget)&&h.preventDefault()}),()=>{e==null||e.removeEventListener("focus",()=>{S?t==null||t.focus():n==null||n.focus()}),e==null||e.removeEventListener("blur",function(h){d!=null&&d.contains(h.relatedTarget)&&h.preventDefault()})}},[S]);const ke=r.useCallback(e=>{(e.key==="ArrowDown"||e.key===" ")&&!l?(e.preventDefault(),e.stopPropagation(),y(!0)):e.key==="Escape"&&(e.preventDefault(),e.stopPropagation(),y(!1))},[l]),we=r.useCallback(e=>{if(e.key==="ArrowDown"){e.preventDefault(),e.stopPropagation();const t=b.current;t&&(c?E(t,void 0):E(t,a))}else if(e.key==="Escape")e.preventDefault(),e.stopPropagation(),y(!1);else if(e.key==="Tab"&&!e.shiftKey){const t=b.current;t&&(e.preventDefault(),e.stopPropagation(),E(t,a))}else e.key==="Enter"&&l&&(e.preventDefault(),e.stopPropagation())},[b,a,c,l]),je=r.useCallback(e=>{if(e.key==="Tab")e.preventDefault(),e.stopPropagation(),e.shiftKey&&f.current?f.current.focus():g.current&&(_(e.currentTarget.value),y(!1),g.current.focus());else if(e.key==="ArrowUp"&&b.current&&f.current){const t=b.current.querySelector('[role="option"]:not([hidden])');e.currentTarget.id===(t==null?void 0:t.id)&&f.current&&f.current.focus()}},[b]);return r.useEffect(()=>{const e=t=>{t.key==="Escape"&&l&&y(!1)};return typeof window<"u"&&l&&window.addEventListener("keydown",e),()=>{typeof window<"u"&&window.removeEventListener("keydown",e)}},[l]),o.jsxs(o.Fragment,{children:[o.jsxs("select",{name:v,tabIndex:-1,"data-testid":"jkl-native-select",className:"jkl-sr-only","aria-hidden":!0,ref:be,value:a,onChange:Ee,children:[o.jsx("option",{value:""})," ",w.map(e=>o.jsx("option",{hidden:!e.visible,value:e.value,children:e.label},`${p}-opt-${e.value}`))]}),o.jsx(Ce,{ref:K,"data-testid":"jkl-select",className:ne("jkl-select",ue,{"jkl-select--inline":W,"jkl-select--open":l&&w.some(e=>e.visible),"jkl-select--no-value":!X,"jkl-select--invalid":!!U||de}),tooltip:j&&te.isValidElement(j)?te.cloneElement(j,{triggerProps:{...j.props.triggerProps,onFocus:e=>{var t,n;(n=(t=j.props.triggerProps)==null?void 0:t.onFocus)==null||n.call(t,e),R()}}}):null,...ge,id:c?N:F,style:{"--jkl-select-max-shown-options":me,...ve},density:pe,label:H,labelProps:{id:J,srOnly:W,...ie,htmlFor:c?N:F},helpLabel:ce,errorLabel:U,render:({"aria-invalid":e,...t})=>o.jsxs("div",{className:"jkl-select__outer-wrapper",style:{width:fe},children:[c&&o.jsx("input",{...t,"aria-invalid":e,id:N,hidden:!S,ref:f,placeholder:"Søk",value:k,onChange:n=>O(n.target.value),"data-testid":"jkl-select__search-input",className:"jkl-select__search-input","aria-autocomplete":"list","aria-activedescendant":X?`${p}__${ae(a)}`:void 0,"aria-controls":p,"aria-expanded":l,role:"combobox",onKeyDown:we,onBlur:M,onFocus:G,onClick:n=>{n.stopPropagation()}}),o.jsx("button",{"aria-invalid":e,...t,id:F,ref:g,hidden:S,type:"button",name:`${v}-btn`,className:ne("jkl-select__button",{"jkl-select__button--active-value":!!a}),"data-testid":"jkl-select__button","aria-label":`${Y||"Velg"},${H}`,"aria-expanded":l,"aria-controls":p,onBlur:M,onFocus:G,onKeyDown:ke,onClick:A,onMouseDown:n=>{var d;n.preventDefault(),(d=g.current)==null||d.focus()},children:Y}),o.jsx("div",{id:p,ref:b,role:"listbox",className:"jkl-select__options-menu",hidden:!l||w.every(n=>!n.visible),"aria-labelledby":J,tabIndex:-1,"data-focus":"controlled",children:w.map((n,d)=>n.visible?o.jsxs("button",{hidden:!n.visible,type:"button",id:`${p}__${ae(n.value)}`,className:"jkl-select__option","data-testid":"jkl-select__option","aria-selected":n.value===a,role:"option",value:n.value,"data-testautoid":`jkl-select__option-${d}`,onBlur:M,onFocus:G,onKeyDown:je,onClick:h=>{h.preventDefault(),ye(n)},onMouseOver:he,children:[n.label,n.description?o.jsx("span",{className:"jkl-select__option-description",children:n.description}):null]},`${p}-${n.value}`):null)}),o.jsx(Pe,{variant:"medium",pointingDown:!l,className:"jkl-select__arrow"})]})})]})});D.displayName="Select";D.__docgenInfo={description:"",methods:[],displayName:"Select",props:{"data-testautoid":{required:!1,tsType:{name:"string"},description:""},id:{required:!1,tsType:{name:"string"},description:""},name:{required:!0,tsType:{name:"string"},description:""},label:{required:!0,tsType:{name:"string"},description:""},labelProps:{required:!1,tsType:{name:"Omit",elements:[{name:"LabelProps"},{name:"union",raw:'"children" | "density" | "htmlFor" | "standAlone"',elements:[{name:"literal",value:'"children"'},{name:"literal",value:'"density"'},{name:"literal",value:'"htmlFor"'},{name:"literal",value:'"standAlone"'}]}],raw:`Omit<
    LabelProps,
    "children" | "density" | "htmlFor" | "standAlone"
>`},description:""},items:{required:!0,tsType:{name:"Array",elements:[{name:"union",raw:"string | ValuePair",elements:[{name:"string"},{name:"signature",type:"object",raw:`{
    value: string;
    label: string;
    description?: string;
}`,signature:{properties:[{key:"value",value:{name:"string",required:!0}},{key:"label",value:{name:"string",required:!0}},{key:"description",value:{name:"string",required:!1}}]}}]}],raw:"Array<string | ValuePair>"},description:""},inline:{required:!1,tsType:{name:"boolean"},description:"@default false"},defaultPrompt:{required:!1,tsType:{name:"string"},description:'@default "Velg"'},className:{required:!1,tsType:{name:"string"},description:""},value:{required:!1,tsType:{name:"string"},description:""},helpLabel:{required:!1,tsType:{name:"string"},description:""},errorLabel:{required:!1,tsType:{name:"string"},description:""},searchable:{required:!1,tsType:{name:"union",raw:`| boolean
| ((searchValue: string, searchItem: string | ValuePair) => boolean)`,elements:[{name:"boolean"},{name:"unknown"}]},description:"@default false"},density:{required:!1,tsType:{name:"union",raw:'"comfortable" | "compact"',elements:[{name:"literal",value:'"comfortable"'},{name:"literal",value:'"compact"'}]},description:""},width:{required:!1,tsType:{name:"string"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:`(
    event: SelectPartialChangeEvent,
) => void`,signature:{arguments:[{type:{name:"SelectPartialChangeEvent"},name:"event"}],return:{name:"void"}}},description:""},onBlur:{required:!1,tsType:{name:"signature",type:"function",raw:`(
    event: SelectPartialChangeEvent,
) => void`,signature:{arguments:[{type:{name:"SelectPartialChangeEvent"},name:"event"}],return:{name:"void"}}},description:""},onFocus:{required:!1,tsType:{name:"signature",type:"function",raw:`(
    event: SelectPartialChangeEvent,
) => void`,signature:{arguments:[{type:{name:"SelectPartialChangeEvent"},name:"event"}],return:{name:"void"}}},description:""},invalid:{required:!1,tsType:{name:"boolean"},description:`Merk som ugyldig uten å sende inn en errorLabel.
NB! Brukes kun i tilfeller der valideringsfeil dukker opp andre steder, for eksempel i en FieldGroup.`},maxShownOptions:{required:!1,tsType:{name:"number"},description:`Hvor mange valg skal vises i listen før den begynner å scrolle.
@default 5`}},composes:["Omit"]};const Je={title:"Komponenter/Select",component:D,parameters:{layout:"padded"},tags:["autodocs"]},qe={name:"Select",label:"Hvilket merke er telefonen?",items:[{value:"Apple",label:"Apple"},{value:"Samsung",label:"Samsung"},{value:"Google",label:"Google"},{value:"OnePlus",label:"OnePlus"},{value:"Nokia",label:"Nokia"}]},q={args:qe,render:({...s})=>o.jsx(D,{...s})};var se,le,oe;q.parameters={...q.parameters,docs:{...(se=q.parameters)==null?void 0:se.docs,source:{originalSource:`{
  args: baseArgs,
  render: ({
    ...props
  }) => <Select {...props} />
}`,...(oe=(le=q.parameters)==null?void 0:le.docs)==null?void 0:oe.source}}};const Qe=["SelectStory"];export{q as SelectStory,Qe as __namedExportsOrder,Je as default};
