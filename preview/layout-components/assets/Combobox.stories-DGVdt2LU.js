import{j as n}from"./jsx-runtime-D9p_MChh.js";import{c as G}from"./clsx-B-dksMZM.js";import{r}from"./index-CRL2yuNo.js";import{u as fe}from"./useAnimatedHeight-B__Vaf29.js";import{u as ve}from"./useId-BJAJhdYZ.js";import{u as ge}from"./useListNavigation-CVJtHmpg.js";import{C as ye}from"./Chip-BAW7Fcsp.js";import{I as ke}from"./IconButton-BK1PK2Od.js";import{C as he}from"./CheckIcon-DGlTyc0x.js";import{A as xe}from"./ArrowVerticalAnimated-DX0UpNqb.js";import{I as je}from"./InputGroup-BiaUcKYD.js";import{T as we,a as _e,b as Ce}from"./TooltipTrigger-Bew01w0J.js";import"./_commonjsHelpers-gnU0ypJ3.js";import"./tokens-NmszT_nq.js";import"./useBrowserPreferences-pnXkstjW.js";import"./usePreviousValue-B4HAJZS8.js";import"./CloseIcon-BmhIuoBP.js";import"./Icon-BsB2AusX.js";import"./ArrowUpIcon-DdvvG9ni.js";import"./Label-C5Kh-mkG.js";import"./SupportLabel-umH_qbZM.js";import"./ErrorIcon-1chdNO9D.js";import"./WarningIcon-B-HIgOlo.js";import"./getThemeAndDensity-h_pKpmQq.js";import"./index-DO_xWACW.js";import"./index-BI6CK2Jw.js";function Ae(c){return typeof c=="string"?{value:c,label:c}:c}const I=({id:c,placeholder:W,items:g,onChange:x,onFocus:T,onBlur:q,value:L,label:N,noMatchingOption:X,labelProps:z,helpLabel:Q,errorLabel:R,width:Y,density:Z,name:d,className:ee,invalid:te,hasTagHover:ae})=>{var B,K;const u=ve(c||"jkl-combobox",{generateSuffix:!c}),O=`${u}_label`,re=`${u}_button`,ne=`${u}_search-input`,[a,y]=r.useState(L||[]),[i,m]=r.useState(!1),[f,k]=r.useState(""),[se,oe]=r.useState(!1),[$,S]=r.useState(!1),o=r.useRef(null),j=r.useRef(null),w=r.useRef(!1);r.useEffect(()=>{k(""),i&&o.current&&o.current.focus()},[i]),r.useEffect(()=>{y(e=>L||e)},[L]);const P=e=>a?a.some(t=>t.value===e.value):!1,_=r.useCallback(e=>a.filter(t=>t.value!==e),[a]),C=r.useCallback((e,t)=>{const s=_(t);y(s),x({type:"change",target:{name:d,value:t,selectedOptions:s}}),e.stopPropagation(),s.length===0&&S(!1)},[_,x,d]),le=r.useCallback(e=>{var s;let t;if(a.some(l=>l.value===e))t=_(e);else{const l=g.find(v=>v.value===e);t=[...a,l]}(s=o.current)==null||s.focus(),y(t),x({type:"change",target:{name:d,value:e,selectedOptions:t}})},[a,x,d,_,g]),ie=e=>{var t;(t=o.current)==null||t.focus(),m(!0),k(e.target.value)},E=r.useMemo(()=>{if(!f)return g;const e=g.filter(t=>t.label.toLowerCase().indexOf(f.toLowerCase())>=0);return oe(e.length===0),e},[f,g]),[ue,ce]=r.useState((B=E[0])!=null&&B.value?`${u}-${(K=E[0])==null?void 0:K.value}`:void 0),de=!i;r.useEffect(()=>{const e=t=>{t.key==="Escape"&&i&&m(!1)};return typeof window<"u"&&window.addEventListener("keydown",e),()=>{typeof window<"u"&&i&&window.removeEventListener("keydown",e)}},[i]);const D=r.useCallback(e=>{e?o.current&&o.current.focus():w.current&&j.current&&j.current.focus()},[]),h=r.useCallback(()=>{w.current||(T&&T({type:"change",target:{name:d,value:(a==null?void 0:a[0].value)||"",selectedOptions:a}}),w.current=!0,m(!0))},[T,a,d]),[p]=fe(i,{onFirstVisible:D,onTransitionEnd:D});ge({ref:p});const F=r.useRef(null),b=r.useCallback(e=>{var l,v;const t=F.current;(t==null?void 0:t.contains(e.relatedTarget))||(k(""),q&&(q({type:"blur",target:{name:d,value:((l=a==null?void 0:a[0])==null?void 0:l.value)||"",selectedOptions:a}}),(v=j.current)==null||v.dispatchEvent(new Event("focusout",{bubbles:!0}))),w.current=!1,m(!1))},[q,d,a]),me=r.useCallback(e=>{e.target.focus({preventScroll:!0})},[]),pe=r.useCallback(e=>{var t;if(e.key==="ArrowDown"){e.preventDefault(),e.stopPropagation();const s=p.current;s&&((t=s.querySelector('[role="option"]'))==null||t.focus())}else e.key==="Escape"&&(e.preventDefault(),e.stopPropagation(),m(!1));if(e.metaKey&&e.key==="a"||e.ctrlKey&&e.key==="a"){e.preventDefault(),e.stopPropagation();const s=a.map(l=>({...l,isMarked:!0}));S(!0),y(s)}else if(e.key==="Backspace")if(e.stopPropagation(),S(!1),a.some(l=>l.isMarked)){const l=a.filter(v=>!v.isMarked);y(l),k("")}else a.length>0&&f===""&&C(e,a[a.length-1].value)},[a,f,p,C]),be=r.useCallback(e=>{if(e.key==="Tab")o.current&&(e.preventDefault(),e.stopPropagation(),e.shiftKey||m(!1),o.current.focus());else if(e.key==="ArrowUp"&&p.current&&o.current){const t=p.current.querySelector('[role="option"]:not([hidden])');e.currentTarget.id===(t==null?void 0:t.id)&&o.current&&o.current.focus()}},[p]),M=a.length>=1,V=r.useCallback(e=>n.jsx(ye,{"data-testid":"jkl-chip","aria-label":`Fjern ${e.tagLabel}`,className:`jkl-combobox__selected-option ${$&&"jkl-combobox__selected-option--marked"}`,variant:"input",onClick:t=>{o.current&&o.current.focus(),C(t,e.value)},onBlur:b,children:e.tagLabel?e.tagLabel:e.label},e.value),[b,C,$]);return n.jsx(je,{label:N,id:ne,ref:F,"data-testid":"jkl-combobox",className:G("jkl-combobox",ee,{"jkl-combobox--invalid":!!R||te,"jkl-combobox--menu-open":i,"jkl-combobox--menu-closed":!i&&M}),labelProps:{id:O,...z},helpLabel:Q,errorLabel:R,density:Z,render:e=>n.jsxs("div",{className:G("jkl-combobox__wrapper",{"jkl-combobox__wrapper--active-value":M}),style:{width:Y},tabIndex:-1,onFocus:h,onBlur:b,children:[n.jsxs("div",{className:"jkl-combobox__chips","data-testid":"jkl-combobox__chips",children:[a.map(Ae).map(t=>ae?n.jsxs(we,{children:[n.jsx(_e,{children:V(t)}),n.jsx(Ce,{children:t.label})]},t.value):V(t)),n.jsx("input",{...e,className:"jkl-combobox__search-input",onChange:ie,"data-testid":"jkl-combobox__search-input",onFocus:h,onBlur:b,onKeyDown:pe,value:f,ref:o,"aria-controls":u,role:"combobox","aria-autocomplete":"list","aria-expanded":i,placeholder:a.length>0?"":W,autoComplete:"off"})]}),n.jsxs("div",{className:"jkl-combobox__menu",role:"listbox",ref:p,id:u,"aria-labelledby":O,"aria-multiselectable":"true","aria-activedescendant":ue,onFocus:h,onBlur:b,tabIndex:-1,children:[E.map((t,s)=>n.jsxs("button",{type:"button",id:`${u}__${t.value}`,"aria-selected":P(t),role:"option",value:t.value,onBlur:b,className:`jkl-combobox__option ${P(t)&&"jkl-combobox__option--selected"}`,"data-testid":"jkl-combobox__option","data-testautoid":`jkl-combobox__option-${s}`,onFocus:h,onKeyDown:be,onClick:l=>{ce(`${u}__${t.value}`),l.stopPropagation(),le(t.value),k("")},onMouseOver:me,children:[t.description?n.jsxs("span",{children:[t.label,n.jsx("span",{className:"jkl-combobox__option-description",children:t.description})]}):t.label,P(t)?n.jsxs("span",{children:[n.jsx(he,{})," "]}):null]},`${u}-${t.value}`)),se&&n.jsx("div",{className:"jkl-combobox__no-option",children:X})]}),n.jsx("div",{className:"jkl-combobox__actions",children:n.jsx(ke,{id:re,onFocus:h,onBlur:b,className:"jkl-combobox__button","data-testid":"jkl-combobox__button","aria-label":`${a.map(t=>t.label)||"Velg"},${N}`,"aria-expanded":i,"aria-controls":u,onClick:()=>m(t=>!t),onMouseDown:t=>{var s;t.preventDefault(),(s=j.current)==null||s.focus()},children:n.jsx(xe,{pointingDown:de})})})]})})};I.displayName="Combobox";I.__docgenInfo={description:"",methods:[],displayName:"Combobox",props:{children:{required:!1,tsType:{name:"union",raw:"ReactNode | ReactNode[]",elements:[{name:"ReactNode"},{name:"Array",elements:[{name:"ReactNode"}],raw:"ReactNode[]"}]},description:""},"data-testautoid":{required:!1,tsType:{name:"string"},description:""},id:{required:!1,tsType:{name:"string"},description:""},className:{required:!1,tsType:{name:"string"},description:""},"data-testid":{required:!1,tsType:{name:"string"},description:""},density:{required:!1,tsType:{name:"union",raw:'"comfortable" | "compact"',elements:[{name:"literal",value:'"comfortable"'},{name:"literal",value:'"compact"'}]},description:""},errorLabel:{required:!1,tsType:{name:"string"},description:""},helpLabel:{required:!1,tsType:{name:"string"},description:""},inline:{required:!1,tsType:{name:"boolean"},description:""},label:{required:!0,tsType:{name:"string"},description:""},labelProps:{required:!1,tsType:{name:"Omit",elements:[{name:"LabelProps"},{name:"union",raw:'"children" | "density" | "htmlFor" | "standAlone"',elements:[{name:"literal",value:'"children"'},{name:"literal",value:'"density"'},{name:"literal",value:'"htmlFor"'},{name:"literal",value:'"standAlone"'}]}],raw:`Omit<
    LabelProps,
    "children" | "density" | "htmlFor" | "standAlone"
>`},description:""},supportLabelProps:{required:!1,tsType:{name:"Omit",elements:[{name:"SupportLabelProps"},{name:"union",raw:'"id" | "errorLabel" | "helpLabel" | "density"',elements:[{name:"literal",value:'"id"'},{name:"literal",value:'"errorLabel"'},{name:"literal",value:'"helpLabel"'},{name:"literal",value:'"density"'}]}],raw:`Omit<
    SupportLabelProps,
    "id" | "errorLabel" | "helpLabel" | "density"
>`},description:""},tooltip:{required:!1,tsType:{name:"ReactNode"},description:""},style:{required:!1,tsType:{name:"CSSProperties"},description:""},render:{required:!1,tsType:{name:"signature",type:"function",raw:"(props: InputProps) => JSX.Element",signature:{arguments:[{type:{name:"InputProps"},name:"props"}],return:{name:"JSX.Element"}}},description:""},placeholder:{required:!1,tsType:{name:"string"},description:""},items:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    value: string;
    label: string;
    description?: string;
}`,signature:{properties:[{key:"value",value:{name:"string",required:!0}},{key:"label",value:{name:"string",required:!0}},{key:"description",value:{name:"string",required:!1}}]}}],raw:"Array<ValuePair>"},description:""},noMatchingOption:{required:!1,tsType:{name:"string"},description:""},name:{required:!0,tsType:{name:"string"},description:""},value:{required:!1,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    value: string;
    label: string;
    description?: string;
}`,signature:{properties:[{key:"value",value:{name:"string",required:!0}},{key:"label",value:{name:"string",required:!0}},{key:"description",value:{name:"string",required:!1}}]}}],raw:"Array<ValuePair>"},description:""},width:{required:!1,tsType:{name:"string"},description:""},invalid:{required:!1,tsType:{name:"boolean"},description:""},hasTagHover:{required:!1,tsType:{name:"boolean"},description:""},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:`(
    event: ComboboxPartialChangeEvent,
) => void`,signature:{arguments:[{type:{name:"ComboboxPartialChangeEvent"},name:"event"}],return:{name:"void"}}},description:""},onBlur:{required:!1,tsType:{name:"signature",type:"function",raw:`(
    event: ComboboxPartialChangeEvent,
) => void`,signature:{arguments:[{type:{name:"ComboboxPartialChangeEvent"},name:"event"}],return:{name:"void"}}},description:""},onFocus:{required:!1,tsType:{name:"signature",type:"function",raw:`(
    event: ComboboxPartialChangeEvent,
) => void`,signature:{arguments:[{type:{name:"ComboboxPartialChangeEvent"},name:"event"}],return:{name:"void"}}},description:""}}};const et={title:"Komponenter/Combobox",component:I,parameters:{layout:"centered"},tags:["autodocs"]},Te=[{value:"a080",label:"A080 - Rotavirusenteritt",tagLabel:"A080"},{value:"a081",label:"A081 - Akutt gastroenteritt som skyldes norovirus",tagLabel:"A081"},{value:"a082",label:"A082 - Adenovirusenteritt",tagLabel:"A082"},{value:"a083",label:"A083 - Annen virusenteritt",tagLabel:"A083"},{value:"a084",label:"A084 - Uspesifisert virusinfeksjon i mage-tarmkanalen",tagLabel:"A084"},{value:"a085",label:"A085 - Annen spesifisert mage-tarminfeksjon",tagLabel:"A085"},{value:"a090",label:"A090 - Annen eller uspesifisert gastroenteritt eller kolitt av infeksiøs årsak",tagLabel:"A090"},{value:"a099",label:"A099 - Gastroenteritt eller kolitt av uspesifisert årsak",tagLabel:"A099"},{value:"a150",label:"A150 - Lungetuberkulose bekreftet ved mikroskopi av sputum med eller uten kultur",tagLabel:"A150"}],A={args:{items:Te,label:"Velg sykdommer",name:"disease",onChange:()=>{}},decorators:c=>n.jsx("div",{style:{maxWidth:220},children:n.jsx(c,{})})};var H,J,U;A.parameters={...A.parameters,docs:{...(H=A.parameters)==null?void 0:H.docs,source:{originalSource:`{
  args: {
    items,
    label: "Velg sykdommer",
    name: "disease",
    onChange: () => {}
  },
  decorators: Story => <div style={{
    maxWidth: 220
  }}>
            <Story />
        </div>
}`,...(U=(J=A.parameters)==null?void 0:J.docs)==null?void 0:U.source}}};const tt=["Combobox"];export{A as Combobox,tt as __namedExportsOrder,et as default};
