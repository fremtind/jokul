import{j as o}from"./jsx-runtime-DqZpzl9T.js";import{c as Z}from"./clsx-B-dksMZM.js";import{r as t,R as ee}from"./index-siqcju79.js";import{u as he}from"./useAnimatedHeight-BAxzwhOL.js";import{u as ke}from"./useId-CahK3IZ3.js";import{u as we}from"./useListNavigation-Bf1PKTdz.js";import{u as te}from"./usePreviousValue-f0kyfTHz.js";import{g as je}from"./valuePair-Bn6SadUn.js";import{A as Ee}from"./ArrowVerticalAnimated-_8egr3Vd.js";import{I as _e}from"./InputGroup-BFZ5w6w_.js";function ne(g=""){return g.toLowerCase().replace(/[\W_]+/g,"")}function S(g,d){let p=null;d&&(p=g.querySelector('[aria-selected="true"]:not([hidden])')),(!d||!p)&&(p=g.querySelector('[role="option"]')),p?.focus(),g.scrollTop=p?.offsetTop||0}const xe=()=>{},re=t.forwardRef((g,d)=>{const{id:p,name:f,items:x,value:l,label:M,labelProps:se,onChange:q,onBlur:I,onFocus:V,className:ae,helpLabel:le,errorLabel:G,invalid:oe,searchable:C=!1,inline:H=!1,defaultPrompt:U="Velg",density:ie,width:ue,maxShownOptions:ce=5,style:de,tooltip:w,...pe}=g,u=ke(p||"jkl-select",{generateSuffix:!p}),W=`${u}_label`,F=`${u}_button`,D=`${u}_search-input`,[a,b]=t.useState(!1),L=t.useCallback(()=>{b(e=>!e)},[]),i=!!C,j=i&&a,[h,R]=t.useState(""),z=t.useCallback(e=>e.label.toLowerCase().includes(h.toLowerCase())?!0:typeof C=="function"?C(h,e):!1,[C,h]),k=t.useMemo(()=>x.map(je).map(e=>{const r=!i||h===""||z(e);return{...e,visible:r}}),[x,i,h,z]),N=t.useMemo(()=>typeof l>"u"?!1:x.some(e=>typeof e=="string"?e===l:e.value===l),[l,x]),[s,E]=t.useState(N&&l!==void 0?l:""),J=s!=="",Q=t.useMemo(()=>k.find(e=>e.value===s)?.label||U,[k,s,U]),_=t.useRef(null),fe=t.useCallback(e=>{_.current=e,d&&(typeof d=="function"?d(e):d.current=e),e&&E(e.value)},[d]),X=te(l);t.useEffect(()=>{l!==X&&E(typeof l>"u"||!N?"":l)},[l,X,N]);const me=t.useCallback(e=>{const r=e.value;R(""),E(r),L(),m.current?.focus()},[L]),$=te(s);t.useEffect(()=>{typeof $>"u"||$===s||s===l||(q&&q({type:"change",target:{name:f,value:s}}),_.current&&_.current.dispatchEvent(new Event("change",{bubbles:!0})))},[q,f,l,s,$]);const A=t.useRef(null),T=t.useRef(!1),c=t.useRef(null),m=t.useRef(null),Y=t.useCallback((e,r)=>{if(e&&!i){const n=r.current;n&&S(n,s)}else e?c.current&&c.current.focus():T.current&&m.current&&m.current.focus()},[i,s]),[v]=he(a,{onFirstVisible:Y,onTransitionEnd:Y});we({ref:v});const O=t.useCallback(()=>{i&&R(""),I&&(I({type:"blur",target:{name:f,value:s}}),_.current?.dispatchEvent(new Event("focusout",{bubbles:!0}))),T.current=!1,b(!1)},[I,i,f,s]),B=t.useCallback(e=>{A.current?.contains(e.relatedTarget)||O()},[O]),K=t.useCallback(()=>{T.current||(V&&V({type:"change",target:{name:f,value:s}}),T.current=!0)},[V,s,f]),ve=t.useCallback(e=>{e.target.focus({preventScroll:!0})},[]);t.useEffect(()=>{const e=_.current,r=c.current,n=m.current,P=A.current;return e?.addEventListener("focus",()=>{j?r?.focus():n?.focus()}),e?.addEventListener("blur",function(y){P?.contains(y.relatedTarget)&&y.preventDefault()}),()=>{e?.removeEventListener("focus",()=>{j?r?.focus():n?.focus()}),e?.removeEventListener("blur",function(y){P?.contains(y.relatedTarget)&&y.preventDefault()})}},[j]);const ge=t.useCallback(e=>{(e.key==="ArrowDown"||e.key===" ")&&!a?(e.preventDefault(),e.stopPropagation(),b(!0)):e.key==="Escape"&&(e.preventDefault(),e.stopPropagation(),b(!1))},[a]),be=t.useCallback(e=>{if(e.key==="ArrowDown"){e.preventDefault(),e.stopPropagation();const r=v.current;r&&(i?S(r,void 0):S(r,s))}else if(e.key==="Escape")e.preventDefault(),e.stopPropagation(),b(!1);else if(e.key==="Tab"&&!e.shiftKey){const r=v.current;r&&(e.preventDefault(),e.stopPropagation(),S(r,s))}else e.key==="Enter"&&a&&(e.preventDefault(),e.stopPropagation())},[v,s,i,a]),ye=t.useCallback(e=>{if(e.key==="Tab")e.preventDefault(),e.stopPropagation(),e.shiftKey&&c.current?c.current.focus():m.current&&(E(e.currentTarget.value),b(!1),m.current.focus());else if(e.key==="ArrowUp"&&v.current&&c.current){const r=v.current.querySelector('[role="option"]:not([hidden])');e.currentTarget.id===r?.id&&c.current&&c.current.focus()}},[v]);return t.useEffect(()=>{const e=r=>{r.key==="Escape"&&a&&b(!1)};return typeof window<"u"&&a&&window.addEventListener("keydown",e),()=>{typeof window<"u"&&window.removeEventListener("keydown",e)}},[a]),o.jsxs(o.Fragment,{children:[o.jsxs("select",{name:f,tabIndex:-1,"data-testid":"jkl-native-select",className:"jkl-sr-only","aria-hidden":!0,ref:fe,value:s,onChange:xe,children:[o.jsx("option",{value:""})," ",k.map(e=>o.jsx("option",{hidden:!e.visible,value:e.value,children:e.label},`${u}-opt-${e.value}`))]}),o.jsx(_e,{ref:A,"data-testid":"jkl-select",className:Z("jkl-select",ae,{"jkl-select--inline":H,"jkl-select--open":a&&k.some(e=>e.visible),"jkl-select--no-value":!J,"jkl-select--invalid":!!G||oe}),tooltip:w&&ee.isValidElement(w)?ee.cloneElement(w,{triggerProps:{...w.props.triggerProps,onFocus:e=>{w.props.triggerProps?.onFocus?.(e),O()}}}):null,...pe,id:i?D:F,style:{"--jkl-select-max-shown-options":ce,...de},density:ie,label:M,labelProps:{id:W,srOnly:H,...se,htmlFor:i?D:F},helpLabel:le,errorLabel:G,render:({"aria-invalid":e,...r})=>o.jsxs("div",{className:"jkl-select__outer-wrapper",style:{width:ue},children:[i&&o.jsx("input",{...r,"aria-invalid":e,id:D,hidden:!j,ref:c,placeholder:"Søk",value:h,onChange:n=>R(n.target.value),"data-testid":"jkl-select__search-input",className:"jkl-select__search-input","aria-autocomplete":"list","aria-activedescendant":J?`${u}__${ne(s)}`:void 0,"aria-controls":u,"aria-expanded":a,role:"combobox",onKeyDown:be,onBlur:B,onFocus:K,onClick:n=>{n.stopPropagation()}}),o.jsx("button",{"aria-invalid":e,...r,id:F,ref:m,hidden:j,type:"button",name:`${f}-btn`,className:Z("jkl-select__button",{"jkl-select__button--active-value":!!s}),"data-testid":"jkl-select__button","aria-label":`${Q||"Velg"},${M}`,"aria-expanded":a,"aria-controls":u,onBlur:B,onFocus:K,onKeyDown:ge,onClick:L,onMouseDown:n=>{n.preventDefault(),m.current?.focus()},children:Q}),o.jsx("div",{id:u,ref:v,role:"listbox",className:"jkl-select__options-menu",hidden:!a||k.every(n=>!n.visible),"aria-labelledby":W,tabIndex:-1,"data-focus":"controlled",children:k.map((n,P)=>n.visible?o.jsxs("button",{hidden:!n.visible,type:"button",id:`${u}__${ne(n.value)}`,className:"jkl-select__option","data-testid":"jkl-select__option","aria-selected":n.value===s,role:"option",value:n.value,"data-testautoid":`jkl-select__option-${P}`,onBlur:B,onFocus:K,onKeyDown:ye,onClick:y=>{y.preventDefault(),me(n)},onMouseOver:ve,children:[n.label,n.description?o.jsx("span",{className:"jkl-select__option-description",children:n.description}):null]},`${u}-${n.value}`):null)}),o.jsx(Ee,{variant:"medium",pointingDown:!a,className:"jkl-select__arrow"})]})})]})});re.displayName="Select";re.__docgenInfo={description:"",methods:[],displayName:"Select",props:{"data-testautoid":{required:!1,tsType:{name:"string"},description:""},id:{required:!1,tsType:{name:"string"},description:""},name:{required:!0,tsType:{name:"string"},description:""},label:{required:!0,tsType:{name:"string"},description:""},labelProps:{required:!1,tsType:{name:"Omit",elements:[{name:"LabelProps"},{name:"union",raw:'"children" | "density" | "htmlFor" | "standAlone"',elements:[{name:"literal",value:'"children"'},{name:"literal",value:'"density"'},{name:"literal",value:'"htmlFor"'},{name:"literal",value:'"standAlone"'}]}],raw:`Omit<
    LabelProps,
    "children" | "density" | "htmlFor" | "standAlone"
>`},description:""},items:{required:!0,tsType:{name:"Array",elements:[{name:"union",raw:"string | ValuePair",elements:[{name:"string"},{name:"signature",type:"object",raw:`{
    value: string;
    label: string;
    description?: string;
}`,signature:{properties:[{key:"value",value:{name:"string",required:!0}},{key:"label",value:{name:"string",required:!0}},{key:"description",value:{name:"string",required:!1}}]}}]}],raw:"Array<string | ValuePair>"},description:""},inline:{required:!1,tsType:{name:"boolean"},description:"@default false"},defaultPrompt:{required:!1,tsType:{name:"string"},description:'@default "Velg"'},className:{required:!1,tsType:{name:"string"},description:""},value:{required:!1,tsType:{name:"string"},description:""},helpLabel:{required:!1,tsType:{name:"string"},description:""},errorLabel:{required:!1,tsType:{name:"string"},description:""},searchable:{required:!1,tsType:{name:"union",raw:`| boolean
| ((searchValue: string, searchItem: string | ValuePair) => boolean)`,elements:[{name:"boolean"},{name:"unknown"}]},description:"@default false"},density:{required:!1,tsType:{name:"union",raw:'"comfortable" | "compact"',elements:[{name:"literal",value:'"comfortable"'},{name:"literal",value:'"compact"'}]},description:""},width:{required:!1,tsType:{name:"string"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:`(
    event: SelectPartialChangeEvent,
) => void`,signature:{arguments:[{type:{name:"SelectPartialChangeEvent"},name:"event"}],return:{name:"void"}}},description:""},onBlur:{required:!1,tsType:{name:"signature",type:"function",raw:`(
    event: SelectPartialChangeEvent,
) => void`,signature:{arguments:[{type:{name:"SelectPartialChangeEvent"},name:"event"}],return:{name:"void"}}},description:""},onFocus:{required:!1,tsType:{name:"signature",type:"function",raw:`(
    event: SelectPartialChangeEvent,
) => void`,signature:{arguments:[{type:{name:"SelectPartialChangeEvent"},name:"event"}],return:{name:"void"}}},description:""},invalid:{required:!1,tsType:{name:"boolean"},description:`Merk som ugyldig uten å sende inn en errorLabel.
NB! Brukes kun i tilfeller der valideringsfeil dukker opp andre steder, for eksempel i en FieldGroup.`},maxShownOptions:{required:!1,tsType:{name:"number"},description:`Hvor mange valg skal vises i listen før den begynner å scrolle.
@default 5`}},composes:["Omit"]};export{re as S};
